## 一、样本权重（Sample Weight） ##

作用：防止极端样本主导模型

市场上有些日子波动非常大（黑天鹅/突发事件）

或某些股票价格异常，可能误导树模型

做法：

```
给不同样本赋权重

低权重给高波动或异常收益的股票

高权重给典型、稳定样本

```
XGBoost 支持 sample_weight 参数

效果：

让模型关注“常规市场状态”，避免被噪声过拟合

## 二、因子权重（Feature Weight / Importance） ##

作用：限制弱因子主导预测

对不同因子可以赋不同初始权重

或通过正则化控制树分裂对某些因子的依赖

做法：

```
对历史经验因子（市值、价值等）给高权重

新开发的 alpha 因子可以先给低权重，让模型慢慢学

XGBoost 可以用 feature_prior 或者直接做树约束

```
效果：

避免模型过度依赖偶然噪声因子

## 三、行业/市值/风险权重（中性化约束） ##

作用：剥离系统性风险

XGBoost 会捕捉所有模式，包括 size premium、行业效应

你真正想要的是 纯 alpha

做法：
```
在训练前做行业/市值中性化

线性回归残差作为 target

或在组合构建阶段加权重约束

限制每个行业/市值的暴露
```

效果：

减少模型只学到风险溢价而非真实 alpha

## 四、时间权重（Temporal Weighting） ##

作用：降低 regime shift 带来的过拟合

市场长期演变，早期样本可能不适合预测现在

可以用时间衰减权重

做法：

给最近样本更高权重，历史样本递减

XGBoost 支持在 sample_weight 中做时间加权

效果：

模型更贴近近期市场状态，减少过拟合历史特定行情

## 五、正则化 + 树约束（Tree Weighting） ##

XGBoost 原生的约束其实也是一种权重策略：

```
L1/L2 正则化（控制叶子权重）

shrinkage（learning_rate，降低每棵树对总预测的贡献）

max_depth / min_child_weight（限制每棵树复杂度）

colsample_bytree / subsample（随机抽样特征和样本）

```
直觉理解：

这些都是给模型学习能力“加权限制”，防止过拟合。

## 六、综合策略示意 ##

量化实战里典型流程：
```
1️⃣ 数据预处理
    - 行业/市值中性化
    - 异常值处理
    - 样本时间权重

2️⃣ 特征构建
    - 复权价格因子
    - 情绪因子数字化
    - 基本面/现实权重因子

3️⃣ XGBoost 训练
    - 树正则化：L1, L2, shrinkage
    - 样本加权 + 时间衰减
    - 特征加权 / 限制重要性

4️⃣ 输出 alpha
    - 可以做 Fama-French 因子回归残差
    - 确保暴露在系统性风险最小

5️⃣ 组合构建
    - 限制行业、市值暴露
    - 权重归一化
```
## 七、实战经验总结 ##

```
控制叶子权重（L1/L2 + shrinkage） = 核心防过拟合

时间权重 = 减少 regime shift 学到噪声

样本权重 + 异常剔除 = 减少极端值影响

行业/市值中性化 + 回归残差 = 避免模型吃风险溢价

特征约束/权重 = 控制偶然噪声因子影响
```

这套方法在日线量化选股里非常常用，也是大部分成熟团队稳定实盘的秘诀。
